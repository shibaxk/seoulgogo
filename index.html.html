<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>2025é¦–çˆ¾ç ´ç ´çˆ›çˆ›ä¹‹æ—…</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['"Zen Maru Gothic"', 'sans-serif'],
            },
            colors: {
              primary: '#FF4757', // Reddish Pink
              secondary: '#FFA502', // Warm Yellow
              dark: '#2F3542',
              bg: '#FFF3E0', // Creamy
              'naver': '#03C75A',
              'google': '#4285F4',
            },
            padding: {
                'safe': 'env(safe-area-inset-bottom)',
            }
          }
        }
      }
    </script>

    <style>
        /* CSS Reset & Custom Styles */
        body {
            background-color: #FFF3E0;
            overscroll-behavior-y: auto;
            touch-action: pan-y;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Zen Maru Gothic', sans-serif;
        }
        
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Plane Animation */
        @keyframes fly {
            0% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            100% { transform: translateX(-5px); }
        }
        @keyframes fly-reverse {
            0% { transform: scaleX(-1) translateX(-5px); }
            50% { transform: scaleX(-1) translateX(5px); }
            100% { transform: scaleX(-1) translateX(-5px); }
        }
        .animate-fly {
            display: inline-block;
            animation: fly 2.5s infinite ease-in-out;
        }
        .animate-fly-reverse {
            display: inline-block;
            animation: fly-reverse 2.5s infinite ease-in-out;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "framer-motion": "https://esm.sh/framer-motion@^12.23.26"
  }
}
</script>
</head>
<body class="text-dark selection:bg-primary selection:text-white">

    <!-- App Container -->
    <div id="app" class="min-h-screen relative flex flex-col">
        
        <!-- Top Nav -->
        <div id="top-nav" class="fixed top-0 left-0 right-0 z-50 bg-bg/95 backdrop-blur-sm shadow-sm rounded-b-3xl transition-all duration-300">
            <div class="pt-4 pb-2 px-4 text-center">
                <h1 class="text-xl font-black tracking-widest text-dark">2025é¦–çˆ¾ç ´ç ´çˆ›çˆ›ä¹‹æ—…</h1>
                <div id="countdown" class="mt-1 inline-block bg-dark text-white text-xs px-3 py-1 rounded-full animate-pulse font-bold">
                    è¨ˆç®—ä¸­...
                </div>
            </div>

            <!-- Tabs -->
            <div class="grid grid-cols-3 mt-2 border-b-2 border-dashed border-gray-200 pb-2 px-2">
                <button onclick="switchTab('HOME')" id="tab-btn-home" class="text-center py-2 font-bold text-lg transition-all text-primary border-b-4 border-primary">é¦–é </button>
                <button onclick="switchTab('SCHEDULE')" id="tab-btn-schedule" class="text-center py-2 font-bold text-lg transition-all text-gray-400">è¡Œç¨‹</button>
                <button onclick="switchTab('WALLET')" id="tab-btn-wallet" class="text-center py-2 font-bold text-lg transition-all text-gray-400">æ¶ˆè²»</button>
            </div>

            <!-- Day Slider (Only for Schedule) -->
            <div id="day-slider-container" class="hidden overflow-x-auto whitespace-nowrap py-3 px-2 no-scrollbar bg-white/50 backdrop-blur-sm transition-all border-t border-gray-100">
                <div id="day-buttons" class="flex space-x-3 px-2">
                    <!-- Day buttons generated by JS -->
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div id="main-content" class="flex-1 w-full pb-32 px-5 overflow-x-hidden transition-all duration-300 pt-[110px]">
            <!-- Content injected by JS -->
        </div>

        <!-- Bottom Nav -->
        <div class="fixed bottom-0 left-0 right-0 bg-dark text-white py-3 flex justify-around items-center z-50 text-xs font-medium tracking-widest pb-[env(safe-area-inset-bottom)] shadow-lg rounded-t-xl">
            <button onclick="switchTab('HOME')" class="opacity-80 hover:opacity-100 uppercase py-2 px-6">Home</button>
            <button onclick="switchTab('SCHEDULE')" class="opacity-80 hover:opacity-100 uppercase py-2 px-6">Schedule</button>
            <button onclick="switchTab('WALLET')" class="opacity-80 hover:opacity-100 uppercase py-2 px-6">Wallet</button>
        </div>

    </div>

<script>
    /** --- Data Constants --- */
    // æˆå“¡åå–®
    const MEMBERS = ["City", "çš®çš®", "æå§†å§", "Eddie", "å®—å®—", "Ray"];
    
    const FLIGHT_OUTBOUND = {
        code: "CI160", time: "07:50 - 11:20", weight: "æ‰‹æ7kg / è¨—é‹23kg", date: "2025/12/19"
    };
    const FLIGHT_INBOUND = {
        code: "CI163", time: "20:15 - 22:10", weight: "æ‰‹æ7kg / è¨—é‹23kg", date: "2025/12/23"
    };

    const ACCOMMODATION = {
        name: "Hongik Univ Station Wave Family Suite #2",
        location: "åœ°éµå¼˜å¤§ç«™",
        address: "ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì™€ìš°ì‚°ë¡œ29ê¸¸ 48-24",
        phone: "+82-10-3690-1913"
    };

    const INITIAL_CHECKLIST = [
        { id: '1', text: 'è­·ç…§', category: 'è­‰ä»¶', checked: false },
        { id: '2', text: 'åœ‹éš›é§•ç…§', category: 'è­‰ä»¶', checked: false },
        { id: '3', text: 'å°ç£é§•ç…§', category: 'è­‰ä»¶', checked: false },
        { id: '4', text: 'Esim / ç¶²å¡', category: 'é›»å­', checked: false },
        { id: '5', text: 'éŸ“åœ‹è½‰æ¥æ’é ­', category: 'é›»å­', checked: false },
        { id: '6', text: 'å°å¹£ / ä¿¡ç”¨å¡', category: 'éŒ¢åŒ…', checked: false },
        { id: '7', text: 'Tmoney äº¤é€šå¡', category: 'éŒ¢åŒ…', checked: false },
        { id: '8', text: 'å¸¸å‚™è—¥å“', category: 'ç”Ÿæ´»', checked: false },
        { id: '9', text: 'æ¯›å¸½ / åœå·¾', category: 'è¡£ç‰©', checked: false },
        { id: '10', text: 'ç™¼ç†±è¡£è¤²', category: 'è¡£ç‰©', checked: false },
    ];

    const SCHEDULE_DATA = [
        {
            day: 1, date: "12/19 (äº”)", title: "å‡ºç™¼æ—¥ & å¼˜å¤§",
            items: [
                { time: "05:00", title: "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆé›†åˆ", category: "è¡Œ", info: "åƒè²´è³“å®¤+é£›æ©Ÿç¡è¦ºåƒåƒå–å– (è²´è³“å®¤1äºº390çµ¦çš®çš®)", googleMapQuery: "æ¡ƒåœ’æ©Ÿå ´ç¬¬ä¸€èˆªå»ˆ" },
                { time: "11:20", title: "æŠµé”ä»å·æ©Ÿå ´ -> å¼˜å¤§", category: "è¡Œ", info: "5è™Ÿå‡ºå£/7è™Ÿå‡ºå£(æ©Ÿå ´éµè·¯)", transport: "æ©Ÿå ´å¿«ç·šç´„40-50åˆ†", isNaverHidden: true },
                { time: "13:00", title: "å¯„æ”¾è¡Œæ & è¡Œç¨‹é–‹å§‹", originalName: "å¼˜å¤§/é«˜é™½AQUAFIELD", category: "ç©", info: "PlanA æå§†å§æ–¹æ¡ˆï¼šå¼˜å¤§(GM/Covernat/thisisneverthatÂ®/adererror)\nPlanB çš®çš®æ–¹æ¡ˆï¼š(é«˜é™½AQUAFIELDæ±—è’¸å¹•)\nçµæŸåƒæ™šé¤", naverQuery: "ì•„ì¿ ì•„í•„ë“œê³ ì–‘" }
            ]
        },
        {
            day: 2, date: "12/20 (å…­)", title: "éŸ“æœé«”é©— & æ™‚å°šå·¡ç¦®",
            items: [
                { time: "13:00", title: "æ™¯ç¦å®®éŸ“æœé«”é©—", category: "ç©", info: "ä¸€äºº377çµ¦çš®çš®ï¼Œæå‰10-15åˆ†é˜åˆ°", transport: "åœ°éµæ™¯ç¦å®®ç«™4è™Ÿå‡ºå£", naverQuery: "ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ ì‚¬ì§ë¡œ 137 (ì ì„ ë™ 11) 2ì¸µ" },
                { time: "Free", title: "å¸‚å€é€›é€› Free", category: "ç©", info: "åœ°é»: ç‹é·—äº­/Atissu/Noice/è²æœåº—/æ˜æ´/LVæ——è‰¦åº—", isNaverHidden: true }
            ]
        },
        {
            day: 3, date: "12/21 (æ—¥)", title: "ç¡é£½é£½ & è–æ°´æ´",
            items: [
                { time: "Free", title: "ç¡åˆ°é£½ -> å¸‚å€è¡Œç¨‹", category: "ç©", info: "æ±å¤§é–€ / 51Percentè–æ°´æ´ / Satur / Coor / è ¶å®¤ / æ¨‚å¤©è–èª•å¸‚é›†", isNaverHidden: true }
            ]
        },
        {
            day: 4, date: "12/22 (ä¸€)", title: "æ¨‚å¤©ç§Ÿè»Š & éƒŠå€éŠ",
            items: [
                { time: "08:30", title: "æ¨‚å¤©ç§Ÿè»Šé¦–çˆ¾ç«™", category: "è¡Œ", info: "åœ‹éš›é§•ç…§/è­·ç…§/å°ç£é§•ç…§ è¦æå‰10-15åˆ†é˜åˆ°", transport: "é¦–çˆ¾ç«™15è™Ÿå‡ºå£æ­¥è¡Œ3åˆ†é˜", naverQuery: "ë¡¯ë°ë Œí„°ì¹´ ì„œìš¸ì—­ì§€ì " },
                { time: "Free", title: "ä¸€æ—¥éŠè¡Œç¨‹å¾…å®š", category: "ç©", info: "å—æ€¡å³¶å‘¨é‚Š / ä»å·å‘¨é‚Š / æŠ±å·å‘¨é‚Š", transport: "è‡ªé§•" }
            ]
        },
        {
            day: 5, date: "12/23 (äºŒ)", title: "é†«ç¾ & å›å®¶",
            items: [
                { time: "11:00", title: "é€€æˆ¿ -> é†«ç¾è¡Œç¨‹", category: "ç©", info: "é€€æˆ¿å¾Œè‡ªç”±æ´»å‹•æˆ–é†«ç¾" },
                { time: "19:30", title: "æŠµé”ä»å·äºŒèˆªå»ˆ", originalName: "ì¸ì²œêµ­ì œê³µí•­", category: "è¡Œ", info: "é€€ç¨…ã€è‡ªç”±æ´»å‹•", transport: "Arexæ©Ÿå ´å¿«ç·šæ™®é€šè»Š", naverQuery: "ì¸ì²œêµ­ì œê³µí•­ ì œ2ì—¬ê°í„°ë¯¸ë„" }
            ]
        }
    ];

    const RATE = 47; // Exchange Rate

    /** --- State Management --- */
    let state = {
        tab: 'HOME', // HOME, SCHEDULE, WALLET
        day: 1,
        checklist: JSON.parse(localStorage.getItem('checklist')) || INITIAL_CHECKLIST,
        expenses: JSON.parse(localStorage.getItem('expenses')) || [],
        walletPayer: MEMBERS[0]
    };

    /** --- Decoration SVGs --- */
    const svgs = {
        shinchan: `<svg class="w-10 h-10 absolute -top-4 -left-3 drop-shadow-md transform -rotate-12 z-10 pointer-events-none" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 8C7 8 8 5 12 5C16 5 17 8 17 8" stroke="#2F3542" strokeWidth="3" strokeLinecap="round"/><path d="M4 12C4 12 5 20 12 20C19 20 20 12 20 12" stroke="#2F3542" strokeWidth="2" strokeLinecap="round"/><circle cx="8" cy="12" r="1.5" fill="#2F3542"/><circle cx="16" cy="12" r="1.5" fill="#2F3542"/><path d="M12 15C12 15 13 16 14 15" stroke="#FF4757" strokeWidth="2" strokeLinecap="round"/></svg>`,
        snowman: `<svg class="w-10 h-10 absolute -top-4 -left-3 drop-shadow-md transform -rotate-12 z-10 pointer-events-none" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="16" r="6" fill="white" stroke="#2F3542" strokeWidth="1.5"/><circle cx="12" cy="8" r="4" fill="white" stroke="#2F3542" strokeWidth="1.5"/><path d="M9 9H15" stroke="#FF4757" strokeWidth="3" strokeLinecap="round"/><path d="M13 9L14.5 14" stroke="#FF4757" strokeWidth="3" strokeLinecap="round"/><circle cx="10.5" cy="7" r="0.6" fill="#2F3542"/><circle cx="13.5" cy="7" r="0.6" fill="#2F3542"/><path d="M12 8L14 8.5L12 9" fill="#FFA502"/><circle cx="12" cy="14" r="0.8" fill="#2F3542"/><circle cx="12" cy="17" r="0.8" fill="#2F3542"/></svg>`,
        flag: `<svg class="w-10 h-10 absolute -top-4 -left-3 drop-shadow-md transform -rotate-12 z-10 pointer-events-none" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="5" width="20" height="14" rx="2" fill="white" stroke="#2F3542" strokeWidth="1.5"/><mask id="taeguk-mask"><circle cx="12" cy="12" r="3.5" fill="white" /></mask><g mask="url(#taeguk-mask)"><circle cx="12" cy="12" r="3.5" fill="#3E65AF" /><path d="M8.5 12 A 1.75 1.75 0 0 1 12 12 A 1.75 1.75 0 0 0 15.5 12 A 3.5 3.5 0 1 0 8.5 12 Z" fill="#CD2E3A"/></g><g stroke="#2F3542" strokeWidth="1.2" strokeLinecap="round"><line x1="4" y1="7" x2="6" y2="7" /><line x1="4" y1="8.5" x2="6" y2="8.5" /><line x1="4" y1="10" x2="6" y2="10" /><line x1="18" y1="14" x2="20" y2="14" /><line x1="18" y1="15.5" x2="20" y2="15.5" /><line x1="18" y1="17" x2="20" y2="17" /><line x1="18" y1="7" x2="20" y2="7" /><line x1="18" y1="8.5" x2="20" y2="8.5" /><line x1="18" y1="10" x2="20" y2="10" /><line x1="4" y1="14" x2="6" y2="14" /><line x1="4" y1="15.5" x2="6" y2="15.5" /><line x1="4" y1="17" x2="6" y2="17" /></g></svg>`,
        soju: `<svg class="w-10 h-10 absolute -top-4 -left-3 drop-shadow-md transform -rotate-12 z-10 pointer-events-none" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="8" y="8" width="8" height="12" rx="2" fill="#03C75A" fillOpacity="0.9"/><rect x="10" y="3" width="4" height="5" fill="#eee" stroke="#2F3542" strokeWidth="1"/><path d="M8 12H16" stroke="white" strokeWidth="1"/><circle cx="12" cy="15" r="1" fill="white"/></svg>`
    };
    
    function getDecor(index) {
        const keys = Object.keys(svgs);
        return svgs[keys[index % keys.length]];
    }

    /** --- Core Functions --- */

    function init() {
        startCountdown();
        render();
        initSwipe();
    }

    function render() {
        updateTopNav();
        const contentDiv = document.getElementById('main-content');
        
        // Dynamic Padding
        if (state.tab === 'SCHEDULE') {
            contentDiv.style.paddingTop = '140px';
        } else {
            contentDiv.style.paddingTop = '110px';
        }

        if (state.tab === 'HOME') {
            contentDiv.innerHTML = renderHome();
        } else if (state.tab === 'SCHEDULE') {
            contentDiv.innerHTML = renderSchedule();
        } else if (state.tab === 'WALLET') {
            contentDiv.innerHTML = renderWallet();
            // Re-bind converter events after render
            setTimeout(initConverter, 0);
        }
    }

    /* --- Page Renders --- */

    function renderHome() {
        // Members - Prominent Display
        const membersHtml = `
            <div class="mb-8 text-center bg-white/50 py-3 rounded-2xl border border-white shadow-sm">
                <div class="text-xs font-bold text-gray-400 mb-2 tracking-widest uppercase">Travel Mates</div>
                <div class="flex flex-wrap gap-2 justify-center px-2">` + 
                MEMBERS.map(m => `
                    <div class="bg-white border border-dark text-dark text-base font-bold px-4 py-1.5 rounded-full shadow-[2px_2px_0px_#2F3542]">
                        ${m}
                    </div>`).join('') + 
                `</div>
            </div>`;

        const renderFlight = (title, flight, isReturn) => {
            const origin = isReturn ? {code:'ICN',c:'ä»å·',t:'T2'} : {code:'TPE',c:'å°åŒ—',t:'T1'};
            const dest = isReturn ? {code:'TPE',c:'å°åŒ—',t:'T1'} : {code:'ICN',c:'ä»å·',t:'T2'};
            const animClass = isReturn ? 'animate-fly-reverse' : 'animate-fly';
            
            return `
            <div class="bg-white rounded-2xl p-5 shadow-lg border-l-8 border-primary relative overflow-visible mb-6">
                ${getDecor(title === "å»ç¨‹" ? 0 : 1)}
                <div class="flex justify-between items-center mb-5 pl-4">
                    <div class="flex flex-col items-start">
                        <span class="bg-primary text-white text-sm font-bold px-3 py-1 rounded-full shadow-sm tracking-wide mb-1">${title}</span>
                        <span class="text-xs font-bold text-gray-400 ml-1">ä¸­è¯èˆªç©º</span>
                    </div>
                    <span class="text-3xl font-black text-secondary tracking-wider drop-shadow-sm">${flight.code}</span>
                </div>
                <div class="flex justify-between items-center relative mb-4">
                    <div class="text-center w-1/4">
                        <div class="text-4xl font-black text-dark">${origin.code}</div>
                        <div class="text-sm font-bold text-gray-500">${origin.c} <span class="text-xs bg-gray-200 px-1 rounded text-gray-600">${origin.t}</span></div>
                    </div>
                    <div class="flex-1 px-2 text-center relative flex flex-col items-center justify-center">
                        <div class="h-[2px] bg-gray-300 w-full absolute top-1/2 left-0 -z-10"></div>
                        <div class="bg-white px-2 z-10 ${animClass}"><span style="font-size: 1.5rem">âœˆï¸</span></div>
                        <div class="text-xl font-black text-primary mt-2 bg-white/80 px-2 rounded-md whitespace-nowrap">${flight.time}</div>
                    </div>
                    <div class="text-center w-1/4">
                        <div class="text-4xl font-black text-dark">${dest.code}</div>
                        <div class="text-sm font-bold text-gray-500">${dest.c} <span class="text-xs bg-gray-200 px-1 rounded text-gray-600">${dest.t}</span></div>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-dashed border-gray-300 flex justify-between text-sm font-medium text-gray-600">
                    <span class="flex items-center gap-1">ğŸ“… ${flight.date}</span>
                    <span class="flex items-center gap-1">ğŸ§³ ${flight.weight}</span>
                </div>
            </div>`;
        };

        const hotelHtml = `
        <div class="bg-white rounded-2xl p-6 shadow-lg relative mb-8 border-t-4 border-secondary overflow-visible">
            ${getDecor(2)}
            <h3 class="text-xl font-black text-dark mb-2 ml-4">ğŸ  ä½å®¿è³‡è¨Š</h3>
            <p className="text-lg font-bold text-secondary mb-2 leading-tight">${ACCOMMODATION.name}</p>
            <p class="text-sm font-bold text-gray-600 mb-1">ğŸ“ ${ACCOMMODATION.location}</p>
            <p class="text-sm text-gray-500 mb-5">${ACCOMMODATION.address}</p>
            <button onclick="window.open('https://map.naver.com/v5/search/${encodeURIComponent(ACCOMMODATION.address)}', '_blank')" 
                class="w-full bg-naver text-white py-3 rounded-xl font-bold text-base shadow-md active:scale-95 transition-transform flex items-center justify-center gap-2">
                <span>ğŸ—ºï¸</span> Naver Map å°èˆª
            </button>
        </div>`;

        const checklistHtml = `
        <div class="bg-white/90 backdrop-blur rounded-2xl p-6 shadow-sm border border-white">
            <h3 class="text-xl font-black text-dark mb-5 border-b-4 border-primary/20 inline-block">ğŸ“ è¡Œå‰æ¸…å–®</h3>
            <div class="space-y-4">
                ${state.checklist.map(item => `
                    <div class="flex items-center space-x-4 cursor-pointer group" onclick="toggleCheck('${item.id}')">
                        <div class="w-7 h-7 rounded-lg border-2 flex items-center justify-center transition-all ${item.checked ? 'bg-primary border-primary rotate-3 scale-110' : 'border-gray-300 bg-white group-hover:border-primary'}">
                            ${item.checked ? '<span class="text-white text-sm font-bold">âœ“</span>' : ''}
                        </div>
                        <span class="text-base font-medium ${item.checked ? 'text-gray-400 line-through decoration-2' : 'text-dark'}">${item.text}</span>
                    </div>
                `).join('')}
            </div>
        </div>`;

        return `<div>${membersHtml}${renderFlight("å»ç¨‹", FLIGHT_OUTBOUND, false)}${renderFlight("å›ç¨‹", FLIGHT_INBOUND, true)}${hotelHtml}${checklistHtml}</div>`;
    }

    function renderSchedule() {
        const dayData = SCHEDULE_DATA.find(d => d.day === state.day);
        if (!dayData) return `<div class="text-center mt-10 text-lg font-bold text-gray-400">å°šç„¡è¡Œç¨‹</div>`;

        const itemsHtml = dayData.items.map((item, index) => {
            const hasMap = (!!item.naverQuery || !!item.googleMapQuery) && !item.isNaverHidden;
            let catColor = 'bg-gray-400';
            if (item.category === 'é£Ÿ') catColor = 'bg-orange-400';
            if (item.category === 'ç©') catColor = 'bg-secondary';
            if (item.category === 'è³¼') catColor = 'bg-pink-400';
            if (item.category === 'è¡Œ') catColor = 'bg-blue-400';

            let mapBtn = '';
            if (hasMap) {
                if (item.googleMapQuery) {
                    mapBtn = `<button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.googleMapQuery)}', '_blank')" class="mt-4 w-full py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 shadow-md transition-transform active:scale-95 bg-google text-white shadow-blue-200"><span>ğŸ“</span> Google Map</button>`;
                } else {
                    mapBtn = `<button onclick="window.open('https://map.naver.com/v5/search/${encodeURIComponent(item.naverQuery)}', '_blank')" class="mt-4 w-full py-3 rounded-xl text-sm font-bold flex items-center justify-center gap-2 shadow-md transition-transform active:scale-95 bg-naver text-white shadow-[0_2px_0_#028f41]"><span>ğŸ“</span> Naver Map</button>`;
                }
            }

            return `
            <div class="relative pl-6 pb-6 last:pb-0">
                <div class="absolute left-0 top-3 bottom-0 w-[3px] bg-gray-300 border-r border-dashed border-gray-400"></div>
                <div class="absolute left-[-28px] top-0 bg-dark text-white text-xs font-bold px-2 py-1.5 rounded-lg w-16 text-center z-10 shadow-[2px_2px_0px_rgba(0,0,0,0.1)]">${item.time}</div>
                
                <div class="mb-4">
                    <div class="bg-white rounded-2xl ml-3 p-4 shadow-md relative border-2 border-transparent hover:border-gray-100 transition-colors z-10">
                        ${getDecor(index)}
                        <span class="absolute top-0 right-0 ${catColor} text-white text-xs px-3 py-1 rounded-bl-xl rounded-tr-xl font-bold shadow-sm">${item.category}</span>
                        <h4 class="font-bold text-dark text-lg mt-2 pr-8 leading-snug">${item.title}</h4>
                        ${item.originalName ? `<p class="text-sm text-gray-400 font-bold mb-2">${item.originalName}</p>` : ''}
                        <p class="text-sm text-gray-700 mt-3 whitespace-pre-line leading-relaxed border-t-2 border-dashed border-gray-100 pt-3">${item.info || ''}</p>
                        ${mapBtn}
                    </div>
                    
                    ${item.transport ? `
                    <div class="ml-3 mt-[-5px] pt-4 px-2 relative z-0">
                         <div class="bg-blue-50 text-blue-700 px-4 py-2 rounded-b-xl rounded-t-md border border-blue-200 text-sm font-bold shadow-sm flex items-center gap-2">
                            <span class="text-lg">ğŸš—</span> 
                            <span>${item.transport}</span>
                         </div>
                    </div>` : ''}
                </div>
            </div>`;
        }).join('');

        return `
        <div class="mb-8 mt-4">
            <h2 class="text-3xl font-black text-dark text-center tracking-tight drop-shadow-sm">${dayData.title}</h2>
            <p class="text-center text-sm font-bold text-primary mt-2 uppercase tracking-[0.2em]">Adventure Log</p>
        </div>
        <div class="pl-4">${itemsHtml}</div>
        `;
    }

    function renderWallet() {
        const totalKRW = state.expenses.reduce((sum, e) => sum + e.amount, 0);
        const totalTWD = Math.round(totalKRW / RATE);

        const payersHtml = MEMBERS.map(m => 
            `<button onclick="setWalletPayer('${m}')" class="whitespace-nowrap px-4 py-2 rounded-full text-sm font-bold border-2 transition-transform active:scale-95 ${state.walletPayer === m ? 'bg-primary text-white border-primary shadow-md' : 'bg-white text-gray-500 border-gray-200'}">${m}</button>`
        ).join('');

        const listHtml = state.expenses.length === 0 
            ? `<div class="text-center text-gray-400 text-sm font-medium py-10">ç›®å‰æ²’æœ‰æ¶ˆè²»ç´€éŒ„</div>`
            : state.expenses.map(ex => `
                <div class="bg-white p-4 rounded-2xl flex justify-between items-center shadow-sm border border-gray-50">
                    <div>
                        <div class="font-bold text-dark text-base">${ex.item}</div>
                        <div class="text-xs font-medium text-gray-400 mt-1">${ex.payer} â€¢ ${new Date(parseInt(ex.id)).toLocaleDateString()}</div>
                    </div>
                    <div class="text-right">
                        <div class="font-black text-primary text-base">â‚©${ex.amount.toLocaleString()}</div>
                        <button onclick="removeExpense('${ex.id}')" class="text-xs font-bold text-gray-300 hover:text-red-400 mt-1 px-2 py-1">åˆªé™¤</button>
                    </div>
                </div>`).join('');

        return `
        <div class="bg-dark text-white rounded-2xl p-6 shadow-xl mb-8 relative overflow-hidden">
            ${getDecor(0)}
            <div class="relative z-10">
                <h3 class="text-gray-400 text-sm font-bold uppercase mb-2 tracking-widest">Total Spending</h3>
                <div class="flex items-baseline gap-3">
                    <span class="text-4xl font-black text-secondary">â‚©${totalKRW.toLocaleString()}</span>
                    <span class="text-base font-medium text-gray-400 mb-1">KRW</span>
                </div>
                <div class="text-lg font-bold text-gray-300 mt-2">â‰ˆ NT$ ${totalTWD.toLocaleString()}</div>
                <div class="mt-3 text-xs font-bold text-gray-500 bg-black/30 inline-block px-3 py-1 rounded-full">åŒ¯ç‡: ${RATE}</div>
            </div>
        </div>

        <!-- Currency Converter -->
        <div class="bg-white rounded-2xl p-5 shadow-md mb-8 border border-gray-100 relative">
            <h4 class="font-black text-lg text-dark mb-4 flex items-center gap-2"><span>ğŸ’±</span> å¿«é€Ÿæ›ç®—</h4>
            <div class="grid grid-cols-[1fr_auto_1fr] gap-2 items-center">
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-bold">NT$</span>
                    <input id="conv-twd" type="number" placeholder="å°å¹£" class="w-full bg-bg pl-10 pr-3 py-3 rounded-xl text-lg font-bold outline-none focus:ring-2 focus:ring-secondary/50" />
                </div>
                <div class="text-gray-300 text-xl font-black">â†”</div>
                <div class="relative">
                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm font-bold">â‚©</span>
                    <input id="conv-krw" type="number" placeholder="éŸ“å¹£" class="w-full bg-bg pl-8 pr-3 py-3 rounded-xl text-lg font-bold outline-none focus:ring-2 focus:ring-secondary/50" />
                </div>
            </div>
            <div class="text-center mt-2 text-xs text-gray-400 font-medium">1 TWD = 47 KRW</div>
        </div>

        <div class="bg-white rounded-2xl p-5 shadow-md mb-8 border border-gray-100">
            <h4 class="font-black text-lg text-dark mb-4 flex items-center gap-2"><span>âœï¸</span> è¨˜ä¸€ç­†</h4>
            <div class="grid grid-cols-2 gap-3 mb-4">
                <input id="input-item" type="text" placeholder="é …ç›®" class="w-full bg-bg p-3 rounded-xl text-base outline-none focus:ring-2 focus:ring-primary/50 font-medium placeholder-gray-400" />
                <input id="input-amount" type="number" placeholder="éŸ“å¹£é‡‘é¡" class="w-full bg-bg p-3 rounded-xl text-base outline-none focus:ring-2 focus:ring-primary/50 font-medium placeholder-gray-400" />
            </div>
            <div class="flex gap-2 mb-4 overflow-x-auto pb-2 no-scrollbar">${payersHtml}</div>
            <button onclick="addExpense()" class="w-full bg-dark text-white py-3.5 rounded-xl font-bold text-base shadow-lg active:scale-95 transition-transform">æ–°å¢ç´€éŒ„</button>
        </div>

        <div class="space-y-4">${listHtml}</div>
        `;
    }

    function initConverter() {
        const twdInput = document.getElementById('conv-twd');
        const krwInput = document.getElementById('conv-krw');
        if(!twdInput || !krwInput) return;

        twdInput.oninput = () => {
             const val = parseFloat(twdInput.value);
             if(!isNaN(val)) krwInput.value = Math.round(val * 47);
             else krwInput.value = '';
        };
        krwInput.oninput = () => {
             const val = parseFloat(krwInput.value);
             if(!isNaN(val)) twdInput.value = Math.round(val / 47);
             else twdInput.value = '';
        };
    }

    function updateTopNav() {
        ['HOME', 'SCHEDULE', 'WALLET'].forEach(tab => {
            const btn = document.getElementById(`tab-btn-${tab.toLowerCase()}`);
            if (state.tab === tab) {
                btn.className = "text-center py-2 font-bold text-lg transition-all text-primary border-b-4 border-primary scale-110";
            } else {
                btn.className = "text-center py-2 font-bold text-lg transition-all text-gray-400 border-b-4 border-transparent";
            }
        });

        const slider = document.getElementById('day-slider-container');
        if (state.tab === 'SCHEDULE') {
            slider.classList.remove('hidden');
            const daysHtml = SCHEDULE_DATA.map(s => `
                <button onclick="switchDay(${s.day})" class="flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold shadow-sm transition-all border ${state.day === s.day ? 'bg-secondary text-white border-secondary transform -translate-y-1' : 'bg-white text-gray-500 border-gray-200'}">
                    DAY ${s.day} <span class="text-xs font-normal block opacity-80">${s.date}</span>
                </button>
            `).join('');
            document.getElementById('day-buttons').innerHTML = daysHtml;
        } else {
            slider.classList.add('hidden');
        }
    }

    /** --- Interaction Handlers --- */
    
    window.switchTab = (newTab) => {
        state.tab = newTab;
        render();
        window.scrollTo(0,0);
    };

    window.switchDay = (newDay) => {
        state.day = newDay;
        render();
        window.scrollTo(0,0);
    };

    window.toggleCheck = (id) => {
        state.checklist = state.checklist.map(item => 
            item.id === id ? { ...item, checked: !item.checked } : item
        );
        localStorage.setItem('checklist', JSON.stringify(state.checklist));
        render();
    };

    window.setWalletPayer = (name) => {
        state.walletPayer = name;
        render();
    };

    window.addExpense = () => {
        const itemInput = document.getElementById('input-item');
        const amountInput = document.getElementById('input-amount');
        const item = itemInput.value;
        const amount = parseFloat(amountInput.value);

        if (!item || isNaN(amount)) return alert('è«‹è¼¸å…¥é …ç›®èˆ‡é‡‘é¡');

        const newExpense = {
            id: Date.now().toString(),
            item,
            amount,
            payer: state.walletPayer,
            category: 'FOOD'
        };
        state.expenses = [newExpense, ...state.expenses];
        localStorage.setItem('expenses', JSON.stringify(state.expenses));
        render();
    };

    window.removeExpense = (id) => {
        if(!confirm('ç¢ºå®šåˆªé™¤?')) return;
        state.expenses = state.expenses.filter(e => e.id !== id);
        localStorage.setItem('expenses', JSON.stringify(state.expenses));
        render();
    };

    /** --- Utilities --- */
    function startCountdown() {
        const targetDate = new Date('2025-12-19T00:00:00+09:00').getTime();
        const el = document.getElementById('countdown');
        
        setInterval(() => {
            const now = new Date().getTime();
            const distance = targetDate - now;
            if (distance < 0) {
                el.innerText = "å‡ºç™¼å•¦ï¼";
                return;
            }
            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            el.innerText = `å€’æ•¸: ${days}å¤© ${hours}æ™‚ ${minutes}åˆ†`;
        }, 1000);
    }

    function initSwipe() {
        let touchStartX = 0;
        let touchEndX = 0;
        const minSwipeDistance = 50;

        document.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: true});

        document.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            if (touchEndX < touchStartX - minSwipeDistance) {
                // Swipe Left -> Next
                if (state.tab === 'HOME') switchTab('SCHEDULE');
                else if (state.tab === 'SCHEDULE') switchTab('WALLET');
            }
            if (touchEndX > touchStartX + minSwipeDistance) {
                // Swipe Right -> Prev
                if (state.tab === 'WALLET') switchTab('SCHEDULE');
                else if (state.tab === 'SCHEDULE') switchTab('HOME');
            }
        }
    }

    // Start App
    document.addEventListener('DOMContentLoaded', init);

</script>
</body>
</html>